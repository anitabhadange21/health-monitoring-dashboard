fetch("health_data.csv")
  .then(response => response.text())
  .then(data => {
    const rows = data.split("\n").slice(1);
    const table = document.getElementById("healthTable");

    let heartRates = [];

    rows.forEach(row => {
      const cols = row.split(",");
      if (cols.length < 7) return;

      const name = cols[0];
      const age = cols[1];
      const heart = parseInt(cols[2]);
      const sys = cols[3];
      const dia = cols[4];
      const oxygen = cols[5];
      const sugar = cols[6];

      heartRates.push(heart);

      let risk = "Low";
      if (oxygen < 94 || sugar > 180 || heart > 90) {
        risk = "High";
      } else if (sugar > 140 || heart > 80) {
        risk = "Medium";
      }

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${name}</td>
        <td>${age}</td>
        <td>${heart}</td>
        <td>${sys}/${dia}</td>
        <td>${oxygen}%</td>
        <td>${sugar}</td>
        <td>${risk}</td>
      `;
      table.appendChild(tr);
    });

    new Chart(document.getElementById("overallChart"), {
      type: "bar",
      data: {
        labels: ["Heart Rate"],
        datasets: [{
          label: "Average Heart Rate",
          data: [heartRates.reduce((a,b)=>a+b)/heartRates.length]
        }]
      }
    });
  });
